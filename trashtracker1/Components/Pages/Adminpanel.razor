@page "/Adminpanel"
@using trashtracker1.Components.HelperServices.API
@using trashtracker1.Components.HelperServices.API.Dto
@using Microsoft.AspNetCore.Components.Forms
@inject trashtracker1.Components.HelperServices.API.ApiClient ApiClient
@rendermode InteractiveServer
<div class="h-[78vh]">
    <div class="bg-white flex text-sm h-full">
        @*Sidebar*@
        <div class="w-50 bg-white flex flex-col justify-between py-3 pt-8 px-1 space-y-2 h-full shadow-[8px_0px_20px_-5px_rgba(0,0,0,0.08)]">
            <div class="space-y-2">
                <button class="w-full bg-gray-200 rounded px-2 py-1 hover:bg-gray-300">Gebruikers</button>
                <button class="w-full bg-gray-200 rounded px-2 py-1 hover:bg-gray-300">Handleiding</button>
            </div>
            <div class="mt-auto">
                <button class="w-full bg-gray-200 rounded px-2 py-1 hover:bg-gray-300">Uitloggen</button>
            </div>
        </div>

        @*Main content*@
        <div class="flex-1 p-8 h-full">
            <div class="bg-gray-100 w-full rounded-xl p-10 h-full flex flex-col space-y-4">
                @*Forms row*@
                <div class="grid grid-cols-1 md:grid-cols-2 gap-12">
                    @*Add User*@
                    <EditForm Model="@creatingUser" OnValidSubmit="@SaveUser" FormName="CreateUserForm">
                        <DataAnnotationsValidator />
                        <div class="bg-white p-3 rounded-lg shadow-xl flex flex-col h-full">
                            <h2 class="text-center font-medium mb-8">Gebruiker toevoegen</h2>

                            <div class="grid grid-cols-2 gap-4 mb-4">
                                <InputText @bind-Value="creatingUser.FirstName" placeholder="Voornaam" class="w-full border border-gray-300 rounded bg-gray-100 px-2 py-1 text-xs text-gray-700 text-center focus:outline-none focus:ring-1 focus:ring-red-400" />
                                <InputText @bind-Value="creatingUser.LastName" placeholder="Achternaam" class="w-full border border-gray-300 rounded bg-gray-100 px-2 py-1 text-xs text-gray-700 text-center focus:outline-none focus:ring-1 focus:ring-red-400" />
                            </div>
                            <div class="grid grid-cols-2 gap-4 mb-4">
                            <InputText @bind-Value="creatingUser.Email" placeholder="Email" type="email" class="w-full border border-gray-300 rounded bg-gray-100 px-2 py-1 text-xs text-gray-700 text-center focus:outline-none focus:ring-1 focus:ring-red-400" />
                                <InputText @bind-Value="creatingUser.Username" placeholder="Gebruikersnaam" class="w-full border border-gray-300 rounded bg-gray-100 px-2 py-1 text-xs text-gray-700 text-center focus:outline-none focus:ring-1 focus:ring-red-400" />
                            </div>
                            <div class="grid grid-cols-2 gap-4 mb-4">
                                <InputText @bind-Value="creatingUser.Password" placeholder="Wachtwoord" class="w-full border border-gray-300 rounded bg-gray-100 px-2 py-1 text-xs text-gray-700 text-center focus:outline-none focus:ring-1 focus:ring-red-400" />
                                <InputText @bind-Value="creatingUser.AdminRole" placeholder="Admin Rol" class="w-full border border-gray-300 rounded bg-gray-100 px-2 py-1 text-xs text-gray-700 text-center focus:outline-none focus:ring-1 focus:ring-red-400" />
                            </div>

                            <div class="grid grid-cols-2 gap-4 mb-1">
                                <div></div>
                                <button type="submit" class="w-full bg-gray-100 border border-gray-300 rounded px-2 py-1 hover:bg-gray-300">
                                    opslaan
                                </button>
                            </div>
                        </div>
                    </EditForm>

                    @*Edit User*@
                    <EditForm Model="@edittingUser" OnValidSubmit="@EditUser" FormName="EditUserForm">
                        <DataAnnotationsValidator />
                        <div class="bg-white p-3 rounded-lg shadow-xl flex flex-col h-full">
                            <h2 class="text-center font-medium mb-8">Gebruiker </h2>

                            <div class="grid grid-cols-2 gap-4 mb-4">
                                <InputText @bind-Value="edittingUser.FirstName" placeholder="Voornaam" class="w-full border border-gray-300 rounded bg-gray-100 px-2 py-1 text-xs text-gray-700 text-center focus:outline-none focus:ring-1 focus:ring-red-400" />
                                <InputText @bind-Value="edittingUser.LastName" placeholder="Achternaam" class="w-full border border-gray-300 rounded bg-gray-100 px-2 py-1 text-xs text-gray-700 text-center focus:outline-none focus:ring-1 focus:ring-red-400" />
                            </div>
                            <div class="grid grid-cols-2 gap-4 mb-4">
                                <InputText @bind-Value="edittingUser.Email" placeholder="Email" type="email" class="w-full border border-gray-300 rounded bg-gray-100 px-2 py-1 text-xs text-gray-700 text-center focus:outline-none focus:ring-1 focus:ring-red-400" />
                                <InputText @bind-Value="edittingUser.Username" placeholder="Gebruikersnaam" class="w-full border border-gray-300 rounded bg-gray-100 px-2 py-1 text-xs text-gray-700 text-center focus:outline-none focus:ring-1 focus:ring-red-400" />
                            </div>
                            <div class="grid grid-cols-2 gap-4 mb-4">
                                <InputText @bind-Value="edittingUser.Password" placeholder="Wachtwoord" class="w-full border border-gray-300 rounded bg-gray-100 px-2 py-1 text-xs text-gray-700 text-center focus:outline-none focus:ring-1 focus:ring-red-400" />
                                <InputText @bind-Value="edittingUser.AdminRole" placeholder="Admin Rol" class="w-full border border-gray-300 rounded bg-gray-100 px-2 py-1 text-xs text-gray-700 text-center focus:outline-none focus:ring-1 focus:ring-red-400" />
                            </div>

                            <div class="grid grid-cols-2 gap-4 mb-1">
                                <div></div>
                                <button type="submit" class="w-full bg-gray-100 border border-gray-300 rounded px-2 py-1 hover:bg-gray-300">
                                    opslaan
                                </button>
                            </div>
                        </div>
                    </EditForm>
                </div>
                @*User List*@
                <h2 class="mb-4 font-medium text-xs text-left">Gebruikers</h2>
                <div class="w-full overflow-auto rounded-lg shadow-xl bg-white p-4">
                    <table class="min-w-full divide-y divide-gray-200">
                        <thead class="bg-gray-100">
                            <tr>
                                <th class="px-6 py-3 text-center text-xs font-medium text-gray-500 uppercase tracking-wider">Voornaam</th>
                                <th class="px-6 py-3 text-center text-xs font-medium text-gray-500 uppercase tracking-wider">Achternaam</th>
                                <th class="px-6 py-3 text-center text-xs font-medium text-gray-500 uppercase tracking-wider">Gebruikersnaam</th>
                                <th class="px-6 py-3 text-center text-xs font-medium text-gray-500 uppercase tracking-wider">E-mailadres</th>
                                <th class="px-6 py-3 text-center text-xs font-medium text-gray-500 uppercase tracking-wider">Is administrator</th>
                                <th class="px-6 py-3 text-center text-xs font-medium text-gray-500 uppercase tracking-wider">Acties</th>
                            </tr>
                        </thead>
                        <tbody class="divide-y divide-gray-200">
                            @if (Users == null)
                            {
                                <p>Loading...</p>
                            }
                            else if (!Users.Any())
                            {
                                <tr>
                                    <td colspan="6" class="px-6 py-4 text-gray-500 italic text-center">Geen gebruikers gevonden...</td>
                                </tr>
                            }
                            else
                            {
                                @foreach (var User in Users)
                                {
                                    <tr class="odd:bg-gray-50">
                                        <td class="px-6 py-4 whitespace-nowrap text-center">@User.FirstName</td>
                                        <td class="px-6 py-4 whitespace-nowrap text-center">@User.LastName</td>
                                        <td class="px-6 py-4 whitespace-nowrap text-center">@User.Username</td>
                                        <td class="px-6 py-4 whitespace-nowrap text-center">@User.Email</td>
                                        <td class="px-6 py-4 whitespace-nowrap text-center">
                                            <span class="px-2 inline-flex text-xs leading-5 font-semibold rounded-full @(User.Role == 1 ? "bg-green-100 text-green-800" : "bg-red-100 text-red-800")">
                                                @(User.Role == 1 ? "Ja" : "Nee")
                                            </span>
                                        </td>
                                        <td class="px-6 py-4 whitespace-nowrap text-center">
                                            <button class="px-4 py-2 font-medium text-white bg-blue-600 rounded-md hover:bg-blue-500 transition" @onclick="async () => await EditUser(User.IdentityUserId)">Bewerk</button>
                                            <button class="ml-4 px-4 py-2 font-medium text-white bg-red-600 rounded-md hover:bg-red-500 transition" @onclick="async () => await DeleteUser(User.IdentityUserId)">Verwijder</button>
                                        </td>
                                    </tr>
                                }
                            }
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>
</div>
@code {
    List<UserDto> Users;
    private UserCreateDto creatingUser = new();
    private UserCreateDto edittingUser = new();

    protected override async Task OnInitializedAsync()
    {
        await LoadUsers();
    }

    private async Task LoadUsers()
    {
        Users = await ApiClient.GetAllUsers(); 
    }

    private async Task SaveUser()
    {
        await ApiClient.RegisterNewUser(creatingUser);
    }

    private async Task EditUserForm()
    {

    }

    private async Task EditUser(string identityUserId)
    {

    }

    private async Task DeleteUser(string identityUserId)
    {
        await ApiClient.DeleteUserByIdentiyUserId(identityUserId);
        await LoadUsers();
        StateHasChanged();
    }
}
